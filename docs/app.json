[{"name":"server.R","content":"library(shiny)\r\n\r\n# Option to allow big files like .fasta files\r\noptions(shiny.maxRequestSize = 1000*1024^2)\r\n\r\n# Install and load packages\r\nif (!requireNamespace(\"BiocManager\", quietly = TRUE))install.packages(\"BiocManager\")\r\nif (!requireNamespace(\"MSstats\", quietly = TRUE)) BiocManager::install(\"MSstats\",force = TRUE)\r\nif (!requireNamespace(\"artMS\", quietly = TRUE)) BiocManager::install(\"artMS\",force = TRUE)\r\nif (!requireNamespace(\"data.table\", quietly = TRUE))install.packages(\"data.table\")\r\nif (!requireNamespace(\"ComplexHeatmap\", quietly = TRUE)) BiocManager::install(\"ComplexHeatmap\")\r\nif (!requireNamespace(\"ggplot2\", quietly = TRUE))install.packages(\"ggplot2\")\r\nif (!requireNamespace(\"readxl\", quietly = TRUE))install.packages(\"readxl\")\r\nif (!requireNamespace(\"shinyjs\", quietly = TRUE))install.packages(\"shinyjs\")\r\nif (!requireNamespace(\"seqinr\", quietly = TRUE))install.packages(\"seqinr\")\r\n\r\nlibrary(BiocManager)\r\nlibrary(artMS)\r\nlibrary(MSstats)\r\nlibrary (data.table)\r\nlibrary (ComplexHeatmap)\r\nlibrary (ggplot2)\r\nlibrary(readxl)\r\nlibrary(shinyjs)\r\nlibrary(seqinr)\r\n\r\nfunction(input, output, session) {\r\n  # Generate QC with button\r\n  observeEvent(input$generate_qc, {\r\n    req(input$evidencefile, input$keysfile)\r\n    output$output_text <- renderText({\"Working... Please Wait.\"}) # Message for user patience \r\n    \r\n    delay(100, { # Delay to display message correctly \r\n      if (!input$qc_basic && !input$qc_ext) { \r\n        output$output_text <- renderText({\"No QC(s) selected\"})\r\n        return()\r\n      }\r\n      \r\n      # Function to zip and download QC folders\r\n      zip_and_download <- function(folder_name) {\r\n        zipfile <- paste0(folder_name, \".zip\")\r\n        zip(zipfile, files = folder_name)\r\n        downloadHandler(\r\n          filename = function() {\r\n            zipfile\r\n          },\r\n          content = function(file) {\r\n            file.copy(zipfile, file)\r\n          },\r\n          contentType = \"application/zip\"\r\n        )\r\n      }\r\n      \r\n      if (input$qc_basic) { # QC basic \r\n        artmsQualityControlEvidenceBasic(\r\n          evidence_file = read.table(input$evidencefile$datapath, header = TRUE, sep = \"\\t\"),\r\n          keys_file = read.table(input$keysfile$datapath, header = TRUE, sep = \"\\t\"),\r\n          prot_exp = \"APMS\"\r\n        )\r\n        \r\n        output$download_basic <- zip_and_download(\"qc_basic\")\r\n        output$download_ui_basic <- renderUI({\r\n          downloadButton(\"download_basic\", \"Download Basic QC\")\r\n        })\r\n      }\r\n      \r\n      if (input$qc_ext) { # QC extended\r\n        artmsQualityControlEvidenceExtended(\r\n          evidence_file = read.table(input$evidencefile$datapath, header = TRUE, sep = \"\\t\"),\r\n          keys_file = read.table(input$keysfile$datapath, header = TRUE, sep = \"\\t\"),\r\n          plotPCA = input$perform_pca\r\n        )\r\n        \r\n        output$download_extended <- zip_and_download(\"qc_extended\")\r\n        output$download_ui_extended <- renderUI({\r\n          downloadButton(\"download_extended\", \"Download Extended QC\")\r\n        })\r\n      }\r\n      \r\n      output$output_text <- renderText({\"Done.\"}) # End message\r\n    })\r\n  })\r\n  \r\n  observeEvent(input$generate_SAINT, { # Message for user patience \r\n    req(input$evidencefile, input$keysfile, input$ref)\r\n    output$output_text2 <- renderText({\"Working... Please Wait.\"})\r\n    \r\n    delay(10, { # Delay to display message correctly \r\n      if (input$msspc) { # Generate files with spectral count\r\n        artmsEvidenceToSaintExpress(\r\n          evidence_file = input$evidencefile$datapath,\r\n          keys_file = input$keysfile$datapath,\r\n          ref_proteome_file = input$ref$datapath,\r\n          quant_variable = \"msspc\",\r\n          output_file = \"msspc.txt\"\r\n        )\r\n        output$download_ui2 <- renderUI({ # UI to download spectral count files\r\n          tagList(\r\n            downloadButton(\"download_msspc_interactions\", \"Download msspc SAINT Interactions\"),\r\n            downloadButton(\"download_msspc_baits\", \"Download msspc SAINT Baits input file\"),\r\n            downloadButton(\"download_msspc_preys\", \"Download msspc SAINT Preys input file\")\r\n          )\r\n        })\r\n      }\r\n      \r\n      if (input$msint) { # Generate files with intensity\r\n        artmsEvidenceToSaintExpress(\r\n          evidence_file = input$evidencefile$datapath,\r\n          keys_file = input$keysfile$datapath,\r\n          ref_proteome_file = input$ref$datapath,\r\n          quant_variable = \"msint\",\r\n          output_file = \"msint.txt\"\r\n        )\r\n        output$download_ui2 <- renderUI({ # UI to download intensity files\r\n          tagList(\r\n            downloadButton(\"download_msint_interactions\", \"Download msint SAINT Interactions\"),\r\n            downloadButton(\"download_msint_baits\", \"Download msint SAINT Baits input file\"),\r\n            downloadButton(\"download_msint_preys\", \"Download msint SAINT Preys input file\")\r\n          )\r\n        })\r\n      }\r\n      \r\n      if (input$msint && input$msspc) { # Generate both with spectral count then intensity\r\n        # Run with msspc\r\n        artmsEvidenceToSaintExpress(\r\n          evidence_file = input$evidencefile$datapath,\r\n          keys_file = input$keysfile$datapath,\r\n          ref_proteome_file = input$ref$datapath,\r\n          quant_variable = \"msspc\",\r\n          output_file = \"msspc.txt\"\r\n        )\r\n        \r\n        # Run with msint\r\n        artmsEvidenceToSaintExpress(\r\n          evidence_file = input$evidencefile$datapath,\r\n          keys_file = input$keysfile$datapath,\r\n          ref_proteome_file = input$ref$datapath,\r\n          quant_variable = \"msint\",\r\n          output_file = \"msint.txt\"\r\n        )\r\n        output$download_ui2 <- renderUI({ # UI to download all files\r\n          tagList(\r\n            downloadButton(\"download_msspc_interactions\", \"Download msspc SAINT Interactions\"),\r\n            downloadButton(\"download_msspc_baits\", \"Download msspc SAINT Baits input file\"),\r\n            downloadButton(\"download_msspc_preys\", \"Download msspc SAINT Preys input file\"),\r\n            downloadButton(\"download_msint_interactions\", \"Download msint SAINT Interactions\"),\r\n            downloadButton(\"download_msint_baits\", \"Download msint SAINT Baits input file\"),\r\n            downloadButton(\"download_msint_preys\", \"Download msint SAINT Preys input file\")\r\n          )\r\n        })\r\n      }\r\n      \r\n      output$output_text2 <- renderText({ \r\n        \"SAINTexpress files generated successfully.\" # End message\r\n      }) \r\n    })\r\n  })\r\n  \r\n  # Download handlers\r\n  output$download_msspc_baits <- downloadHandler(\r\n    filename = function() {\r\n      \"msspc-saint-baits.txt\"\r\n    },\r\n    content = function(file) {\r\n      file.copy(\"msspc-saint-baits.txt\", file)\r\n    }\r\n  )\r\n  \r\n  output$download_msspc_preys <- downloadHandler(\r\n    filename = function() {\r\n      \"msspc-saint-preys.txt\"\r\n    },\r\n    content = function(file) {\r\n      file.copy(\"msspc-saint-preys.txt\", file)\r\n    }\r\n  )\r\n  \r\n  output$download_msspc_interactions <- downloadHandler(\r\n    filename = function() {\r\n      \"msspc-saint-interactions.txt\"\r\n    },\r\n    content = function(file) {\r\n      file.copy(\"msspc-saint-interactions.txt\", file)\r\n    }\r\n  )\r\n  \r\n  output$download_msint_baits <- downloadHandler(\r\n    filename = function() {\r\n      \"msint-saint-baits.txt\"\r\n    },\r\n    content = function(file) {\r\n      file.copy(\"msint-saint-baits.txt\", file)\r\n    }\r\n  )\r\n  \r\n  output$download_msint_preys <- downloadHandler(\r\n    filename = function() {\r\n      \"msint-saint-preys.txt\"\r\n    },\r\n    content = function(file) {\r\n      file.copy(\"msint-saint-preys.txt\", file)\r\n    }\r\n  )\r\n  \r\n  output$download_msint_interactions <- downloadHandler(\r\n    filename = function() {\r\n      \"msint-saint-interactions.txt\"\r\n    },\r\n    content = function(file) {\r\n      file.copy(\"msint-saint-interactions.txt\", file)\r\n    }\r\n  )\r\n}\r\n","type":"text"},{"name":"ui.R","content":"library(shiny)\r\nfluidPage(\r\n  titlePanel(\"QC and SAINT inputs generator\"),\r\n  sidebarLayout(\r\n    sidebarPanel(\r\n      # Upload necessary files \r\n      fileInput(\"evidencefile\", \"Upload evidence.txt\", accept = c(\"text/plain\", \".txt\")),\r\n      fileInput(\"keysfile\", \"Upload keys.txt\", accept = c(\"text/plain\", \".txt\")),\r\n      fileInput(\"ref\", \"Upload Reference proteome\", accept = \".fasta\")\r\n    ),\r\n    mainPanel(\r\n      # Check if the users want to do basic, extended or both QC\r\n      checkboxInput(\"qc_basic\", \"QC_Basic\", value = TRUE),\r\n      checkboxInput(\"qc_ext\", \"QC_Extended\", value = FALSE),\r\n      conditionalPanel(\r\n        condition = \"input.qc_ext == true\",\r\n        checkboxInput(\"perform_pca\", \"Perform PCA (Might take a long time, be patient)\", value = FALSE)\r\n      ),\r\n      # Button to generate QC and message confirming the work is in progress\r\n      actionButton(\"generate_qc\", \"Generate QC(s)\"),\r\n      textOutput(\"output_text\"),\r\n      # Ui for downloading QCs\r\n      uiOutput(\"download_ui_basic\"),\r\n      uiOutput(\"download_ui_extended\"),\r\n      # Check boxes to generate input files for SAINTexpress in spectral count or intensity\r\n      checkboxInput(\"msspc\", \"msspc\", value = TRUE),\r\n      checkboxInput(\"msint\", \"msint\", value = FALSE),\r\n      # Generate the files \r\n      actionButton(\"generate_SAINT\", \"Generate SAINTexpress input files\"),\r\n      textOutput(\"output_text2\"),\r\n      # Download the files\r\n      uiOutput(\"download_ui2\")\r\n    )\r\n  )\r\n)","type":"text"}]
